From fdb3a1fb89f5d5cef4abb9c60abf2c25be69db88 Mon Sep 17 00:00:00 2001
From: Prakash
 <prakash@GARUDACCS-VM.2ebhdqqhnuvexmxvddcl42poof.rx.internal.cloudapp.net>
Date: Thu, 19 Feb 2026 10:58:16 +0000
Subject: [PATCH 3/3] Update schema for decisions/reminders/communications +
 task dates

---
 schema.sql | 61 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 61 insertions(+)

diff --git a/schema.sql b/schema.sql
index 32da92b..1f412f0 100644
--- a/schema.sql
+++ b/schema.sql
@@ -43,10 +43,66 @@ create table if not exists tasks (
   owner text,
   priority text,
   status text not null default 'Todo',
+  start_date date,
+  due_date date,
+  completed_at timestamptz,
   source text,
   unique (scope, area, title)
 );
 
+create index if not exists tasks_scope_idx on tasks(scope);
+create index if not exists tasks_status_idx on tasks(status);
+create index if not exists tasks_owner_idx on tasks(owner);
+create index if not exists tasks_updated_at_idx on tasks(updated_at);
+
+-- Decisions log
+create table if not exists decisions (
+  id bigserial primary key,
+  created_at timestamptz not null default now(),
+  date date not null default (now()::date),
+  decision text not null,
+  context text,
+  decided_by text,
+  scope text not null check (scope in ('adhiratha','personal','minervainfo'))
+);
+
+create index if not exists decisions_date_idx on decisions(date);
+create index if not exists decisions_scope_idx on decisions(scope);
+
+-- Reminders
+create table if not exists reminders (
+  id bigserial primary key,
+  created_at timestamptz not null default now(),
+  updated_at timestamptz not null default now(),
+  title text not null,
+  due_date date,
+  priority text not null default 'P2' check (priority in ('P1','P2','P3')),
+  category text not null default 'work' check (category in ('personal','work','follow-up')),
+  status text not null default 'Open' check (status in ('Open','Done')),
+  scope text not null check (scope in ('adhiratha','personal','minervainfo')),
+  created_by text
+);
+
+create index if not exists reminders_due_idx on reminders(due_date);
+create index if not exists reminders_scope_idx on reminders(scope);
+create index if not exists reminders_status_idx on reminders(status);
+
+-- Communication log (summaries, not full transcripts)
+create table if not exists communications (
+  id bigserial primary key,
+  created_at timestamptz not null default now(),
+  timestamp timestamptz not null default now(),
+  from_agent text,
+  to_agent text,
+  summary text not null,
+  scope text not null check (scope in ('adhiratha','personal','minervainfo')),
+  message_type text
+);
+
+create index if not exists communications_ts_idx on communications(timestamp);
+create index if not exists communications_scope_idx on communications(scope);
+create index if not exists communications_from_idx on communications(from_agent);
+
 -- Magic-link / code auth (temporary dev-code display for Admins)
 create table if not exists auth_codes (
   id bigserial primary key,
@@ -59,3 +115,8 @@ create table if not exists auth_codes (
 
 create index if not exists auth_codes_user_idx on auth_codes(user_id);
 create index if not exists auth_codes_expires_idx on auth_codes(expires_at);
+
+-- Lightweight migration helpers for existing deployments
+alter table tasks add column if not exists start_date date;
+alter table tasks add column if not exists due_date date;
+alter table tasks add column if not exists completed_at timestamptz;
-- 
2.43.0

